<?php
    use Application\Entity\Db\Role;
    use Application\Entity\Db\Privilege;

/**
 * //Provenant du controleur
 * @var Role[] $roles
 * @var Privilege[] $privileges
 *
 * //Utilisée couramment
 * @var Role $role
 * @var Privilege $privilege
 */
?>


<?php $this->headTitle($this->translate("Rôles/Privilèges")) ?>
<h1 class="page-header first"><?php echo $this->translate("Rôles/Privilèges") ?>

</h1>

    <div class="pull-left">
        <?php echo $this->partial('partial/form-filtrage') ?>
    </div>


<?php

//$paramQuery = $this->params()->fromQuery();
//echo $paramQuery;
echo "<input type='submit' value='refresh' id='refresh'/>";
echo "<table id='mytable' class='droits-tbl table table-hover table-bordered table-condensed table-extra-condensed table-header-rotated'>";
echo "<tr><th></th>";

foreach($roles as $role) {
    echo "<th class='rotate-45'> {$role->getLibelle()} </th>";
}
echo "</tr>";


foreach($privileges as $privilege) {
    echo "<tr>";
    echo "<th> {$privilege->getLibelle()} </th>";
    foreach($roles as $role) {

        echo "<td>";

        echo "<a href='".$this->url("modifier-privilege", ['role' => $role->getId(), 'privilege'=> $privilege->getId()], ["query" => $params], true)."' />";
//        echo "[" . $role->getId() . "|" . $privilege->getId() . "|";
//        echo (array_search($role, $privilege->getRole()->toArray()) === false);
//        echo "]";
        if( array_search($role, $privilege->getRole()->toArray()) !== false) {
            echo "<span style='color: green'; class='glyphicon glyphicon-ok'></span>";
        } else {
            echo "<span style='color: red'; class='glyphicon glyphicon-remove'></span>";
        }
        echo "</a>";
        echo "</td>";

    }
    echo "</tr>";
}
echo "</table>";
?>

<script>
    $(document).ready(function() {

        function RefreshTable() {
            //alert("clicked !");
            $("#mytable").innerHTML = "oups";
        }

        $("#refresh").on("click", RefreshTable);

        // OR CAN THIS WAY
        //
        // $("#refresh-btn").on("click", function() {
        //    $( "#mytable" ).load( "your-current-page.html #mytable" );
        // });


    });
</script>


<style>

    .table-header-rotated th.row-header {
        width: auto;

    }

    .table-header-rotated td {
        width: 40px;
        vertical-align: middle;
        text-align: center;
    }

    .table-header-rotated th.rotate-45 {
        /*border: none;*/
        /*height: 200px;*/
        /*width: 40px;*/
        /*min-width: 40px;*/
        /*max-width: 40px;*/
        /*position: relative;*/
        /*vertical-align: bottom;*/
        /*padding: 0;*/
        /*line-height: 1;*/
        /*white-space: nowrap;*/

        /*position: relative;*/
        /*top: 0px;*/
        /*left: 83px;*/
        /*height: 100%;*/
        /*transform: skew(-40deg, 0deg);*/
        /*overflow: hidden;*/
        /*border-right: 1px solid #ddd;*/
    }

    .table-header-rotated th.rotate-45 > div {
        position: relative;
        top: 0px;
        left: 83px;
        height: 100%;
        transform: skew(-40deg, 0deg);
        overflow: hidden;
        border-right: 1px solid #ddd;
    }

    .table-header-rotated th.rotate-45 > div.first {
        border-left: 1px solid #ddd;
    }

    .table-header-rotated th.rotate-45 span {
        transform: skew(40deg, 0deg) rotate(310deg);
        position: absolute;
        bottom: 40px;
        left: -30px;
        display: inline-block;
        width: 100px;
        text-align: left;
    }

    .table-header-rotated .separator {
        border: none;
    }

    .droits-tbl th.privilege {
        min-width: 200px;
        max-width: 200px;
        width: 200px;
    }

    .droits-tbl td span.refuse {
        opacity: 0.5;
    }


</style>