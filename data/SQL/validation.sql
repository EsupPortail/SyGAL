CREATE TABLE VALIDATION    (
	ID NUMBER(*,0), 
	TYPE_VALIDATION_ID NUMBER(*,0), 
	THESE_ID NUMBER(*,0), 
	HISTO_CREATION DATE DEFAULT SYSDATE,
	HISTO_CREATEUR_ID NUMBER(*,0) default 1, 
	HISTO_MODIFICATION DATE DEFAULT SYSDATE, 
	HISTO_MODIFICATEUR_ID NUMBER(*,0) default 1, 
	HISTO_DESTRUCTION DATE, 
	HISTO_DESTRUCTEUR_ID NUMBER(*,0)
   ) ;

create sequence VALIDATION_id_seq;

CREATE TABLE TYPE_VALIDATION    (
	ID NUMBER(*,0), 
	CODE VARCHAR2(50 CHAR),
	LIBELLE VARCHAR2(100 CHAR)
   ) ;

  CREATE INDEX VALIDATION_HCFK_IDX ON VALIDATION (HISTO_CREATEUR_ID) ;
  CREATE INDEX VALIDATION_HDFK_IDX ON VALIDATION (HISTO_DESTRUCTEUR_ID)  ;
  CREATE INDEX VALIDATION_HMFK_IDX ON VALIDATION (HISTO_MODIFICATEUR_ID) ;
  CREATE INDEX VALIDATION_THESE_FK_IDX ON VALIDATION (THESE_ID)  ;
  CREATE UNIQUE INDEX VALIDATION_PK ON VALIDATION (ID)  ;

  CREATE INDEX VALIDATION_TYPE_VALIDATION_FK ON VALIDATION (TYPE_VALIDATION_ID)  ;
  CREATE UNIQUE INDEX TYPE_VALIDATION_PK ON TYPE_VALIDATION (ID) ;

  ALTER TABLE VALIDATION ADD CONSTRAINT VALIDATION_PK PRIMARY KEY (ID);
  ALTER TABLE VALIDATION MODIFY (HISTO_MODIFICATEUR_ID NOT NULL ENABLE);
  ALTER TABLE VALIDATION MODIFY (HISTO_MODIFICATION NOT NULL ENABLE);
  ALTER TABLE VALIDATION MODIFY (HISTO_CREATEUR_ID NOT NULL ENABLE);
  ALTER TABLE VALIDATION MODIFY (HISTO_CREATION NOT NULL ENABLE);
  ALTER TABLE VALIDATION MODIFY (THESE_ID NOT NULL ENABLE);
  ALTER TABLE VALIDATION MODIFY (TYPE_VALIDATION_ID NOT NULL ENABLE);
  ALTER TABLE VALIDATION MODIFY (ID NOT NULL ENABLE);

  ALTER TABLE TYPE_VALIDATION ADD CONSTRAINT TYPE_VALIDATION_PK PRIMARY KEY (ID);
  ALTER TABLE TYPE_VALIDATION MODIFY (CODE NOT NULL ENABLE);
  ALTER TABLE TYPE_VALIDATION MODIFY (ID NOT NULL ENABLE);

  ALTER TABLE VALIDATION ADD CONSTRAINT VALIDATION_HCFK FOREIGN KEY (HISTO_CREATEUR_ID)	  REFERENCES UTILISATEUR (ID) ENABLE;
  ALTER TABLE VALIDATION ADD CONSTRAINT VALIDATION_HDFK FOREIGN KEY (HISTO_DESTRUCTEUR_ID)	  REFERENCES UTILISATEUR (ID) ENABLE;
  ALTER TABLE VALIDATION ADD CONSTRAINT VALIDATION_HMFK FOREIGN KEY (HISTO_MODIFICATEUR_ID)	  REFERENCES UTILISATEUR (ID) ENABLE;
  ALTER TABLE VALIDATION ADD CONSTRAINT VALIDATION_THESE_FK FOREIGN KEY (THESE_ID)	  REFERENCES THESE (ID) ON DELETE CASCADE ENABLE;
  ALTER TABLE VALIDATION ADD CONSTRAINT VALIDATION_TYPE_VALIDATION_FK FOREIGN KEY (TYPE_VALIDATION_ID)	  REFERENCES TYPE_VALIDATION (ID) ON DELETE CASCADE ENABLE;

  ALTER TABLE SODOCT.VALIDATION ADD CONSTRAINT VALIDATION_UN UNIQUE (TYPE_VALIDATION_ID, THESE_ID);

insert into TYPE_VALIDATION(ID, CODE, LIBELLE) values
  (1, 'RDV_BU', 'Validation de la BU suite au rendez-vous avec le doctorant');
